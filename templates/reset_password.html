{% extends "layout.html" %}

{% block content %}
<div style="max-width: 400px; margin: 0 auto; padding-top: 4rem;">
    <div class="glass-panel" style="padding: 2rem;">
        <h2 style="text-align: center;">Nueva Contrase침a</h2>
        <form id="reset-form">
            <div class="form-group">
                <label for="password">Nueva Contrase침a</label>
                <div style="position: relative;">
                    <input type="password" id="password" required style="width: 100%; padding-right: 2.5rem;">
                    <span id="toggle-password"
                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 1.2rem;">游뗻</span>
                </div>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Restablecer</button>
        </form>
        <div id="message" style="margin-top: 1rem; text-align: center; display: none;"></div>
    </div>
</div>

<script>
    // Get token from URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (!token) {
        document.getElementById('message').style.display = 'block';
        document.getElementById('message').style.color = 'red';
        document.getElementById('message').innerText = 'Error: Token inv치lido o faltante.';
        document.getElementById('reset-form').style.display = 'none';
    }

    document.getElementById('toggle-password').addEventListener('click', function () {
        const passwordInput = document.getElementById('password');
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.textContent = type === 'password' ? '游뗻' : '游냣';
    });

    document.getElementById('reset-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const password = document.getElementById('password').value;
        const msgDiv = document.getElementById('message');

        try {
            await axios.post('/auth/reset-password', {
                token: token,
                new_password: password
            });
            msgDiv.style.display = 'block';
            msgDiv.style.color = 'green';
            msgDiv.innerHTML = 'Contrase침a actualizada. <a href="/login">Inicia Sesi칩n</a>';
            document.getElementById('reset-form').reset();
        } catch (error) {
            msgDiv.style.display = 'block';
            msgDiv.style.color = 'red';
            msgDiv.innerText = 'Error: ' + (error.response?.data?.detail || error.message);
        }
    });
</script>
{% endblock %}